<!DOCTYPE html>
<html class="no-js" lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8JMVGDHQTB"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7365457617485825" crossorigin="anonymous"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-8JMVGDHQTB');
  </script>

  <meta charset="UTF-8">
  <title>講義を DX する（その1）</title>
  <meta name="description" content="Notes on Programming.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:title" content="講義を DX する（その1）">
  <meta property="og:description" content="Notes on Programming.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https:&#x2F;&#x2F;github.com&#x2F;taroosg&#x2F;blog&#x2F;issues&#x2F;31">
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/28992410?v=4">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@taroosg" />

  <link rel="apple-touch-icon" href="../favicon.png">
  <link rel="icon" href="../favicon.png">

  <link rel="stylesheet" href="../css/main.css">
  <!-- Fontawsome -->
  <script src="../js/01f767a9a9.js" crossorigin="anonymous"></script>
  <style>
    body {
      padding: 1rem;
      max-width: 960px;
      margin: 0 auto;
    }

    main>div>pre {
      font-size: 14px;
      line-height: var(--line-height);
      padding: var(--spacing);
      max-width: 100vw;
      overflow: auto;
    }

    body>header>hgroup>p>i {
      padding-left: 0.5em;
      padding-right: 0.3em;
    }

    header>nav>ul {
      list-style: none;
      display: flex;
      justify-content: space-evenly;
      padding: 0;
    }
  </style>
</head>

<body>
  <header>
    <nav>
      <ul>
        <li>
          <a href="../" aria-label="Link to top page.">
            <i class="fa-solid fa-home"></i>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/taroosg" target="_blank" aria-label="Link to Twitter page.">
            <i class="fa-brands fa-twitter"></i>
          </a>
        </li>
        <li>
          <a href="https://github.com/taroosg" target="_blank" aria-label="Link to GitHub page.">
            <i class="fa-brands fa-github"></i>
          </a>
        </li>
        <li>
          <a href="https:&#x2F;&#x2F;github.com&#x2F;taroosg&#x2F;blog&#x2F;issues&#x2F;31" target="_blank" aria-label="Link to Issue page.">
            <i class="fa-solid fa-gear"></i>
          </a>
        </li>
      </ul>
    </nav>
    <hgroup>
      <h1>講義を DX する（その1）</h1>
      <p><i class="fa-regular fa-calendar-days"></i>Dec 1st, 2022
        <i class="fa-solid fa-tag"></i>lifehack
        <i class="fa-solid fa-tag"></i>git
        <i class="fa-solid fa-tag"></i>github
        <i class="fa-solid fa-tag"></i>typescript
        <i class="fa-solid fa-tag"></i>deno
      </p>
    </hgroup>
  </header>

  <main>
    <h2>はじめに</h2>
<p>現状（すでに過去であるが），講義は講義資料（スライドを PDF にしたもの）とサンプルコードで進めているが，下記で述べるような数多くの問題が発生している．</p>
<p>クラス数が少ないうちは人力で対応することができるが，オンラインオフライン混在で多くのクラスが同時進行する状況で手が回らなくなっている状況にある．</p>
<p>したがって，「状況に関わらず同質な講義が提供できる」「受講生講師チューターが楽をできる」「持続可能である」仕組みを考案して実現することとした．以下はその試行錯誤の記録である．</p>
<ul>
<li>前半（この記事）</li>
<li>後半（<a href="https://taroosg.github.io/blog/posts/1470796610.html" rel="nofollow">リンク</a>）</li>
</ul>
<h2>今回の DX</h2>
<p>今回の DX （前半）により，下記の状況を達成する．</p>
<ul>
<li>テキスト主体の構成を採用することで，PDF によって発生する講義資料の不具合解消．</li>
<li>オンラインデプロイ方式による講義資料へのアクセス改善．</li>
<li>GitHub Actions を用いた講義資料とサンプルコードの管理や展開の簡略化．</li>
</ul>
<h2>成果物</h2>
<p>本ページで考案した仕組みを組み込んだサンプルを作成した．</p>
<p>講義資料はスライドから HTML に変更し，サンプルコードは資料内のダウンロードリンクからワンクリックでダウンロードが可能だ．</p>
<p>受講生は，デプロイ先の URL にアクセスするだけで受講に必要な情報にアクセスすることができるようになった．</p>
<ul>
<li><a href="https://github.com/taroosg/dx-the-lecture-01">マスタデータのリポジトリ</a></li>
<li>クラス 1 （全ての講義を終えた状態を想定）
<ul>
<li><a href="https://github.com/taroosg/dx-the-lecture-01-class01">リポジトリ</a></li>
<li><a href="https://taroosg.github.io/dx-the-lecture-01-class01/" rel="nofollow">デプロイ</a></li>
</ul>
</li>
<li>クラス 2 （JavaScript 2 回のみを終えた状態を想定）
<ul>
<li><a href="https://github.com/taroosg/dx-the-lecture-01-class02">リポジトリ</a></li>
<li><a href="https://taroosg.github.io/dx-the-lecture-01-class02/" rel="nofollow">デプロイ</a></li>
</ul>
</li>
</ul>
<h2>現状</h2>
<p>現在の講義資料とサンプルコードの展開は以下の手順を必要としている．</p>
<ol>
<li>講義資料（スライド）を作成する．</li>
<li>サンプルコードと同じディレクトリに入れる．</li>
<li>上記ディレクトリを圧縮する．</li>
<li>圧縮したディレクトリを Google ドライブの共有フォルダに保存する．</li>
<li>共有フォルダから zip ファイルをダウンロードする．</li>
<li>zip ファイルを解凍する．</li>
</ol>
<h2>課題</h2>
<p>以下のように，全員不幸になるタイミングが数多く報告されている．</p>
<h3>スライドからコードをコピーした場合に予期せぬエラーが発生する．</h3>
<ul>
<li>講義中，慣れないスペルの場合はコードの一部をコピーしたほうが無難なケースも多い．</li>
<li>主に PDF の改行が原因でエディタ上でエラーが発生する場合がある．</li>
<li>「コードは間違っていないのに何故か動かない」状況が発生し，全員不幸になる．</li>
</ul>
<h3>レイアウトの制約上スライドとコードの区切りが整合しない．</h3>
<ul>
<li>中途半端な区切りやフォントの縮小など望ましくないコードを掲載せざるを得ない場合がある．</li>
<li>コードブロックが改ページで寸断されることで流れが不透明になる．</li>
<li>括弧の対応が不透明になり，タイプミスも増える．</li>
<li>解説する方もされる方も混乱しやすく，全員不幸になる．</li>
</ul>
<h3>講義資料（スライド）の修正時の工数が多い．</h3>
<ul>
<li>スライドを修正する．</li>
<li>共有フォルダに保存する．</li>
<li>ダウンロードする．</li>
<li>解凍する．</li>
<li>旧バージョンを削除する．</li>
<li>その場で修正することができない．</li>
<li>講師受講生双方の手順が煩雑で，全員不幸になる．</li>
</ul>
<h3>スライドとサンプルコードを個別に管理しなければならない．</h3>
<ul>
<li>ファイル名修正などが発生すると双方修正し，再度展開が必要．</li>
<li>上記のスライドと同様の工数が発生する．</li>
<li>記述に齟齬が発生して混乱し，全員不幸になる．</li>
</ul>
<h3>資料の展開を任意のタイミングで行えない．</h3>
<ul>
<li>講義直前に上記のフローを実行する必要がある．</li>
<li>準備しておいて 1 つの動作で展開する，などができない．</li>
<li>行動が時間に束縛され，全員不幸になる．</li>
</ul>
<h3>以前の講義内容（資料）を見たい場合，別ファイルを探してアクセスする必要がある．</h3>
<ul>
<li>自分でファイル及びサンプルコードを管理する必要がある．</li>
<li>見失った場合，再度ダウンロードの手順を踏まなければならない．</li>
<li>煩雑なファイル管理や命名規則が発生し，全員不幸になる．</li>
</ul>
<h2>課題の解決策</h2>
<p>各課題に対して，下記のようなアプローチで検討した．</p>
<ul>
<li>
<p>スライドからコードをコピーした場合に予期せぬエラーが発生する．</p>
</li>
<li>
<p>レイアウトの制約上スライドとコードの区切りが整合しない．</p>
<p>→ PDF ではなく，テキストベースの資料とする．</p>
</li>
<li>
<p>講義資料（スライド）の修正時の工数が多い．</p>
<p>→ ファイルの配布でなく，デプロイして URL を閲覧する形式とする．</p>
</li>
<li>
<p>スライドとサンプルコードを個別に管理しなければならない．</p>
<p>→ 講義資料とサンプルコードを合わせてデプロイし，両者を紐付ける．</p>
</li>
<li>
<p>資料の展開を任意のタイミングで行えない．</p>
<p>→ PC，モバイルを問わずデプロイが可能な環境を構築する．</p>
</li>
<li>
<p>以前の講義内容（資料）を見たい場合，別ファイルを探してアクセスする必要がある．</p>
<p>→ 全ての資料を同じ URL にデプロイすることで，いつでも過去の資料を閲覧できる状態にする．</p>
</li>
</ul>
<h2>具体的な設計</h2>
<p>上記の解決策を実現するため，下記の技術を用いることとした．</p>
<h3>SSG「mdbook」を用いて講義資料作成する．</h3>
<ul>
<li>テキスト主体の資料．</li>
<li>全ての講義資料を同じ URL にデプロイ．</li>
</ul>
<h3>GitHub を用いて講義資料とデプロイの管理を行う．</h3>
<ul>
<li>講義資料のデプロイ．</li>
<li>PC，モバイル問わないデプロイ環境の整備．</li>
</ul>
<h3>GitHub Actions を用いてサンプルコード圧縮とデプロイを行う．</h3>
<ul>
<li>講義資料とサンプルコードの紐づけ．</li>
<li>サンプルコードをワンクリックでダウンロード．</li>
</ul>
<h2>現時点で実現を目指すフロー</h2>
<ol>
<li>マスターとなる講義資料とサンプルコードを事前に準備しておく．</li>
<li>新しいクラスが開始するタイミングで講義資料用のリポジトリを準備する．</li>
<li>マスターの資料からクローンし，vs code 上でクラス毎にユニークとなる部分やデプロイ範囲を設定する．</li>
<li>GitHub にディレクトリを push する．</li>
<li>GitHub 上で main ブランチにマージする．</li>
<li>（自動）GitHub Actions を用いて資料をビルドする</li>
<li>（自動）サンプルコードを zip 圧縮し，講義資料とマージする．</li>
<li>（自動）ビルド完了後，GitHub Pages を用いて自動でデプロイされる．</li>
<li>（デプロイ URL は予め受講生に共有しておく．）</li>
<li>デプロイされた資料からワンクリックでサンプルコードがダウンロードできる．</li>
</ol>
<p>以降，講義準備時は毎回 3-5 を行うのみ．</p>
<p>これらの実現により，</p>
<ul>
<li>受講生は資料のファイル管理や捜索から開放され，コードを書くことに専念できる．</li>
<li>講師側は不毛なスライド作成（個人の感想）から開放されてエディタと GitHub で全てが可能となる．</li>
<li>チューターは毎回資料をダウンロードすることなく，予め指定された URL を押さえておけばすぐに講義に入ることができる．</li>
</ul>
<p>つまり，全員が幸せになる．そして，フローを自作することが GEEK だ．</p>
<p>以下に詳細な内容を紹介する．</p>
<h2>SSG「mdbook」を用いた講義資料作成．</h2>
<p>「mdbook」は Rust 製の SSG フレームワークである．SSG を実現するフレームワークは数多くあるが，ドキュメント生成ツールとしての機能が必要十分であることと，筆者が Rust が好きという理由で採用した．</p>
<p><a href="https://github.com/rust-lang/mdBook">https://github.com/rust-lang/mdBook</a></p>
<p>特徴は下記のとおり．</p>
<ul>
<li>md ファイルで各ファイルを作成する．ビルド後はそれぞれが HTML ファイルとしてデプロイされる．</li>
<li>目次となる md ファイルが存在する．これを操作することで公開する範囲を設定することができる．</li>
<li>テーマの切り替えや JavaScript や PHP のシンタックスハイライトに対応しており，素の状態で十分見やすい．</li>
<li>レスポンシブ対応済．</li>
<li>GitHub Actions を用いたデプロイのサンプルが準備されている．</li>
</ul>
<p>ここでは特に変わった処理は必要ない．各講義毎にディレクトリを作成し，区切り毎に md ファイルをつくって解説を書いていくだけだ．</p>
<p>これを実現することで，謎の改行やページ区切りで混乱する苦行やファイルを管理する面倒な操作を過去のものとした．</p>
<p>やはり時代はテキストだ．環境に依存せず移植が容易なテキストこそ至高である．</p>
<h2>GitHub を用いた講義資料とデプロイの管理．</h2>
<p>GitHub Actions 用の yml ファイル内にデプロイのフローを記述することで GitHub Pages 上にデプロイすることが可能となる．</p>
<p>より具体的には，下記の流れでフローが実行される．</p>
<ol>
<li>「main」ブランチに push されたタイミングでビルドコマンドを実行する．</li>
<li>「ビルドコマンドにより吐き出されたファイルがまとめられているディレクトリ」を「gh-pages」ブランチに push する．</li>
<li>GitHub Pages に「gh-pages」ブランチをデプロイする．</li>
</ol>
<p>実際の yml ファイルは以下のような記述となる（mdbook 公式のサンプルほぼそのまま）．</p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">name</span>: <span class="pl-s">github pages</span>

<span class="pl-ent">on</span>:
  <span class="pl-ent">push</span>:
    <span class="pl-ent">branches</span>:
      - <span class="pl-s">main</span>
  <span class="pl-ent">pull_request</span>:

<span class="pl-ent">jobs</span>:
  <span class="pl-ent">deploy</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-18.04</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v2</span>

      - <span class="pl-ent">name</span>: <span class="pl-s">Setup mdBook</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peaceiris/actions-mdbook@v1</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">mdbook-version</span>: <span class="pl-s"><span class="pl-pds">"</span>0.4.8<span class="pl-pds">"</span></span>
          <span class="pl-c"><span class="pl-c">#</span> mdbook-version: 'latest'</span>

      <span class="pl-c"><span class="pl-c">#</span> mdファイルのビルド</span>
      - <span class="pl-ent">run</span>: <span class="pl-s">mdbook build</span>

      <span class="pl-c"><span class="pl-c">#</span> ビルドされたファイル群をgh-pagesブランチにデプロイ</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Deploy</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peaceiris/actions-gh-pages@v3</span>
        <span class="pl-ent">if</span>: <span class="pl-s">github.ref == 'refs/heads/main'</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">github_token</span>: <span class="pl-s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="pl-ent">publish_dir</span>: <span class="pl-s">./book</span></pre></div>
<p>講師は下記手順で講義資料の準備を行うこととなる．</p>
<ol>
<li>develop ブランチで講義資料を準備する．</li>
<li>準備ができ次第，main ブランチへプルリクエストを送る．</li>
<li>任意のタイミングで main ブランチへのマージを行うことで，上記のフローが実行され，資料がデプロイされる．（マージ操作はモバイルのアプリケーションからでも実行することができる点がポイント）</li>
</ol>
<p>これを実現することで，毎回の PDF 作成 → アップロードの手順や修正に伴う煩雑な作業を駆逐することができた．</p>
<h2>GitHub Actions を用いたサンプルコード圧縮とデプロイ．</h2>
<p>上記のフローでは，講義資料そのものはデプロイができるが，サンプルコードが含まれていない．</p>
<p>このままではサンプルコードは別途 Google ドライブなどに共有する必要がある．これでは，今回の狙いの半分しか達成されていない状況だ．</p>
<p>したがって，ビルドと同時にサンプルコードを zip 形式に圧縮し，デプロイするファイルにマージする処理が必要である．</p>
<p>しかし，これも GitHub Actions 内で実行可能だ．</p>
<p>yml ファイルに下記の処理を追加した．やっていることは必要な処理をシェルコマンドで実行しているだけである．</p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">name</span>: <span class="pl-s">github pages</span>

<span class="pl-ent">on</span>:
  <span class="pl-ent">push</span>:
    <span class="pl-ent">branches</span>:
      - <span class="pl-s">main</span>
  <span class="pl-ent">pull_request</span>:

<span class="pl-ent">jobs</span>:
  <span class="pl-ent">deploy</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-18.04</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v2</span>

      - <span class="pl-ent">name</span>: <span class="pl-s">Setup mdBook</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peaceiris/actions-mdbook@v1</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">mdbook-version</span>: <span class="pl-s"><span class="pl-pds">"</span>0.4.8<span class="pl-pds">"</span></span>
          <span class="pl-c"><span class="pl-c">#</span> mdbook-version: 'latest'</span>

      - <span class="pl-ent">run</span>: <span class="pl-s">mdbook build</span>

      <span class="pl-c"><span class="pl-c">#</span> 🔽 サンプルファイルをzip圧縮してビルドしたファイル群に追加する処理</span>
      - <span class="pl-ent">run</span>: <span class="pl-s">|</span>
<span class="pl-s">          mkdir ./book/samples</span>
<span class="pl-s">          cd samples</span>
<span class="pl-s">          find . \! -name '*.zip' -type d -exec zip -r {}.zip {} \;</span>
<span class="pl-s">          mv *.zip ../book/samples</span>
<span class="pl-s"></span>
<span class="pl-s"></span>      - <span class="pl-ent">name</span>: <span class="pl-s">Deploy</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peaceiris/actions-gh-pages@v3</span>
        <span class="pl-ent">if</span>: <span class="pl-s">github.ref == 'refs/heads/main'</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">github_token</span>: <span class="pl-s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="pl-ent">publish_dir</span>: <span class="pl-s">./book</span></pre></div>
<p>これにより，zip 圧縮されたサンプルコードのファイルが自動でデプロイされるようになった．</p>
<p>あとは，講義資料側に「zip ファイルのパスを指定したリンク」を設定しておけばワンクリックで zip ファイルをダウンロード可能である．</p>
<p>これを実現することで，講義の度に毎回 Google ドライブにアクセスするという面倒な手順をスキップできるようになった．</p>
<h2>まとめと次の課題</h2>
<p>今回の DX により，下記の状況を達成することができた．</p>
<ul>
<li>テキスト主体の構成を採用することで，PDF によって発生する講義資料の不具合解消．</li>
<li>オンラインデプロイ方式による講義資料へのアクセス改善．</li>
<li>GitHub Actions を用いた講義資料とサンプルコードの管理や展開の簡略化．</li>
</ul>
<p><strong>しかし，実使用した結果，下記の課題が残っていることが判明した．</strong></p>
<ul>
<li>新規クラスが開講する度に新しいリポジトリの作成が必要となる．</li>
<li>内容の修正が必要な場合，クラス資料とマスタデータの異なるリポジトリで更新作業が必要となる．</li>
<li>複数の人間が講師を務める場合，お互いの修正を円滑に反映することができない．</li>
</ul>
<p>これでは持続可能な体勢とは言えないので，まだ改善が必要である．．！</p>
<p><a href="https://taroosg.github.io/blog/posts/1470796610.html" rel="nofollow">講義を DX する（その 2）</a>へ続く．．．</p>
  </main>

</body>

</html>