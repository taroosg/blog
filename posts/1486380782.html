<!DOCTYPE html>
<html class="no-js" lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8JMVGDHQTB"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7365457617485825" crossorigin="anonymous"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-8JMVGDHQTB');
  </script>

  <meta charset="UTF-8">
  <title>Fresh ã§ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„</title>
  <meta name="description" content="Notes on Programming.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:title" content="Fresh ã§ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„">
  <meta property="og:description" content="Notes on Programming.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https:&#x2F;&#x2F;github.com&#x2F;taroosg&#x2F;blog&#x2F;issues&#x2F;42">
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/28992410?v=4">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@taroosg" />

  <link rel="apple-touch-icon" href="../favicon.png">
  <link rel="icon" href="../favicon.png">

  <link rel="stylesheet" href="../css/main.css">
  <!-- Fontawsome -->
  <script src="../js/01f767a9a9.js" crossorigin="anonymous"></script>
  <style>
    body {
      padding: 1rem;
      max-width: 960px;
      margin: 0 auto;
    }

    main>div>pre {
      font-size: 14px;
      line-height: var(--line-height);
      padding: var(--spacing);
      max-width: 100vw;
      overflow: auto;
    }

    body>header>hgroup>p>i {
      padding-left: 0.5em;
      padding-right: 0.3em;
    }

    header>nav>ul {
      list-style: none;
      display: flex;
      justify-content: space-evenly;
      padding: 0;
    }
  </style>
</head>

<body>
  <header>
    <nav>
      <ul>
        <li>
          <a href="../" aria-label="Link to top page.">
            <i class="fa-solid fa-home"></i>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/taroosg" target="_blank" aria-label="Link to Twitter page.">
            <i class="fa-brands fa-twitter"></i>
          </a>
        </li>
        <li>
          <a href="https://github.com/taroosg" target="_blank" aria-label="Link to GitHub page.">
            <i class="fa-brands fa-github"></i>
          </a>
        </li>
        <li>
          <a href="https:&#x2F;&#x2F;github.com&#x2F;taroosg&#x2F;blog&#x2F;issues&#x2F;42" target="_blank" aria-label="Link to Issue page.">
            <i class="fa-solid fa-gear"></i>
          </a>
        </li>
      </ul>
    </nav>
    <hgroup>
      <h1>Fresh ã§ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„</h1>
      <p><i class="fa-regular fa-calendar-days"></i>Dec 9th, 2022
        <i class="fa-solid fa-tag"></i>typescript
        <i class="fa-solid fa-tag"></i>deno
        <i class="fa-solid fa-tag"></i>fresh
      </p>
    </hgroup>
  </header>

  <main>
    <h2>çŠ¶æ³</h2>
<ul>
<li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«ãƒ¦ãƒ¼ã‚¶ãƒšãƒ¼ã‚¸ã¨ç®¡ç†è€…ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹ï¼</li>
<li>ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„ï¼</li>
</ul>
<h2>è§£æ±ºç­–</h2>
<p>Fresh ã«ã¯ middleware æ©Ÿèƒ½ãŒå­˜åœ¨ã™ã‚‹ï¼ã“ã‚Œã‚’ç”¨ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç¯„å›²ã‚’çµã£ã¦èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼</p>
<p>å‚è€ƒï¼š <a href="https://fresh.deno.dev/docs/concepts/middleware" rel="nofollow">https://fresh.deno.dev/docs/concepts/middleware</a></p>
<p>ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è€ƒãˆã‚‹ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»¥å¤–ã¯çœç•¥ï¼‰ï¼</p>
<div class="highlight highlight-text-adblock"><pre class="notranslate">.
â””â”€â”€ routes
    â”œâ”€â”€ admin
    â”‚   â”œâ”€â”€ [id].ts
    â”‚   â””â”€â”€ index.ts
    â”œâ”€â”€ [name].tsx
    â”œâ”€â”€ api
    â”‚   â””â”€â”€ joke.ts
    â””â”€â”€ index.tsx</pre></div>
<p><code class="notranslate">admin</code> ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒˆã«èªè¨¼ã‚’ã‹ã‘ãŸã„ã¨ã™ã‚‹å ´åˆï¼Œ<code class="notranslate">admin</code> ä»¥ä¸‹ã« <code class="notranslate">_middleware.ts</code> ã‚’ä½œæˆã—ï¼Œä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ã™ã‚‹ï¼</p>
<div class="highlight highlight-source-ts"><pre class="notranslate"><span class="pl-c">// routes/admin/_middleware.ts</span>

<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-smi">MiddlewareHandlerContext</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"$fresh/server.ts"</span><span class="pl-kos">;</span>

<span class="pl-k">interface</span> <span class="pl-smi">State</span> <span class="pl-kos">{</span>
  <span class="pl-c1">data</span>: <span class="pl-smi">string</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span>

<span class="pl-k">export</span> <span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">handler</span><span class="pl-kos">(</span>
  <span class="pl-s1">req</span>: <span class="pl-smi">Request</span><span class="pl-kos">,</span>
  <span class="pl-s1">ctx</span>: <span class="pl-smi">MiddlewareHandlerContext</span><span class="pl-kos">&lt;</span><span class="pl-smi">State</span><span class="pl-kos">&gt;</span><span class="pl-kos">,</span>
<span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-c">// ğŸ”½ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š</span>
  <span class="pl-k">const</span> <span class="pl-s1">user</span> <span class="pl-c1">=</span> <span class="pl-s">"admin"</span><span class="pl-kos">;</span>
  <span class="pl-k">const</span> <span class="pl-s1">password</span> <span class="pl-c1">=</span> <span class="pl-s">"password"</span><span class="pl-kos">;</span>

  <span class="pl-c">// ğŸ”½ èªè¨¼ã‚’å‹•ã‹ã™ã‚³ãƒ¼ãƒ‰</span>
  <span class="pl-k">if</span> <span class="pl-kos">(</span>
    <span class="pl-s1">req</span><span class="pl-kos">.</span><span class="pl-c1">headers</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">"Authorization"</span><span class="pl-kos">)</span> <span class="pl-c1">!==</span> <span class="pl-s">`Basic <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-en">btoa</span><span class="pl-kos">(</span><span class="pl-s">`<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">user</span><span class="pl-kos">}</span></span>:<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">password</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">}</span></span>`</span>
  <span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-k">const</span> <span class="pl-s1">headers</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">Headers</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
      <span class="pl-s">"WWW-Authenticate"</span>: <span class="pl-s">'Basic realm="Fake Realm"'</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">Response</span><span class="pl-kos">(</span><span class="pl-s">"Unauthorized"</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-c1">401</span><span class="pl-kos">,</span> headers <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span>
  <span class="pl-s1">ctx</span><span class="pl-kos">.</span><span class="pl-c1">state</span><span class="pl-kos">.</span><span class="pl-c1">data</span> <span class="pl-c1">=</span> <span class="pl-s">"myData"</span><span class="pl-kos">;</span>
  <span class="pl-k">const</span> <span class="pl-s1">resp</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">ctx</span><span class="pl-kos">.</span><span class="pl-en">next</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-s1">resp</span><span class="pl-kos">.</span><span class="pl-c1">headers</span><span class="pl-kos">.</span><span class="pl-en">set</span><span class="pl-kos">(</span><span class="pl-s">"server"</span><span class="pl-kos">,</span> <span class="pl-s">"fresh server"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-k">return</span> <span class="pl-s1">resp</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div>
<p>ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ï¼Œ<code class="notranslate">admin</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã®ã¿ã§èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼</p>
<p>åŒæ§˜ã«ä»–ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã‚‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹ã“ã¨ã§åˆ¥ã€…ã® middleware ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹•ã‹ã—ã¦ï¼Œç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼</p>
<h2>ã¾ã¨ã‚</h2>
<ul>
<li>middleware æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ä»»æ„ã®ç¯„å›²ã«èªè¨¼ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼</li>
</ul>
<p>ä»¥ä¸Šã ( `ï½¥Ï‰ï½¥)b</p>
  </main>

</body>

</html>